<div class="techniciens-container">

  <!-- üîô Bouton retour -->
  <button class="btn-back" (click)="goBack()">‚Üê Retour</button>

  <h2>Liste des techniciens</h2>

  <div *ngIf="isLoading" class="loading">Chargement en cours...</div>
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <!-- ‚ûï Bouton ajouter -->
  <div class="actions-bar">
    <button class="btn add" (click)="addTechnicien()">‚ûï Ajouter un technicien</button>
  </div>

  <!-- üßæ Tableau des techniciens -->
  <table class="techniciens-table" *ngIf="!isLoading && techniciens.length > 0">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Email</th>
        <th>√âquipe</th>
        <th>T√¢che assign√©e</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let tech of techniciens">

        <!-- NOM CLIQUABLE -->
        <td>
          <a [routerLink]="['/techniciens', tech.id]" class="tech-link">
            {{ tech.nom }}
          </a>
        </td>

        <td>{{ tech.email }}</td>
        <td>{{ tech.equipe || '-' }}</td>

        <!-- T√ÇCHES ASSIGN√âES -->
        <td>
          <span *ngIf="tech.tache_id; else assignButton">
            üìù T√¢che #{{ tech.tache_id }}
          </span>

          <ng-template #assignButton>
            <button class="btn btn-info btn-sm" (click)="openAssignModal(tech)">
              ‚ûï Assigner une t√¢che
            </button>
          </ng-template>
        </td>

        <!-- ACTIONS -->
        <td>
          <div class="actions-buttons">
            <button class="btn btn-info" (click)="editTechnicien(tech)">‚úèÔ∏è √âditer</button>
            <button class="btn btn-danger" (click)="deleteTechnicien(tech)">üóëÔ∏è Supprimer</button>

            <button *ngIf="tech.tache_id"
                    class="btn btn-warning"
                    (click)="openDeassignModal(tech)">
              ‚ùå D√©sassigner
            </button>
          </div>
        </td>

      </tr>
    </tbody>
  </table>


  <!-- üîµ MODALE ASSIGNATION / D√âSASSIGNATION T√ÇCHE -->
  <div class="modal-overlay" *ngIf="showTacheModal">
    <div class="modal" [ngClass]="{ 'danger': modalMode === 'deassign' }">

      <!-- TITRE -->
      <h3 *ngIf="modalMode === 'assign'">
        Assigner une t√¢che √† {{ modalTech?.nom }}
      </h3>

      <h3 *ngIf="modalMode === 'deassign'">
        D√©sassigner la t√¢che de {{ modalTech?.nom }}
      </h3>

      <!-- ASSIGNATION -->
      <div *ngIf="modalMode === 'assign'">
        <label>Choisir une t√¢che :</label>

        <select [(ngModel)]="selectedTacheId">
          <option [ngValue]="null">-- s√©lectionner --</option>
          <option *ngFor="let t of taches" [ngValue]="t.id">
            {{ t.titre }}
          </option>
        </select>
      </div>

      <!-- D√âSASSIGNATION -->
      <div *ngIf="modalMode === 'deassign'">
        <p>T√¢che actuelle : <strong>{{ selectedTacheTitle }}</strong></p>
      </div>

      <!-- BOUTONS -->
      <div class="modal-actions">
        <button class="btn btn-primary" (click)="confirmTacheAction()">
          Confirmer
        </button>

        <button class="btn btn-secondary" (click)="closeTacheModal()">
          Annuler
        </button>
      </div>

    </div>
  </div>

</div>
